webpackJsonp([55],{"6FZf":function(t,e){},"9Czm":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Xu46"),o={data:function(){return{autoplay:!0,oIndex:0,To:1,loading:!0,dialogVisible:!1,dialogVisibleMainGraph:!1,activeName:"first",uploadFileUrlapp:"https://httpbin.org/post",UpTitle:"",col:[{label:"序号",prop:"Pos",width:"50",sortable:!0},{label:"标题",prop:"ProductCode",width:"200",sortable:!0},{label:"创建时间",prop:"Brand",width:"200",sortable:!0}],dropCol:[{label:"删除",prop:"Pos",width:"50",sortable:!0},{label:"标题",prop:"Title",width:"200",sortable:!0},{label:"创建时间",prop:"CreateDate",width:"200",sortable:!0}],tableData:[],imageUrlList:[],imgVideoBase64List:[],imageUrl:{}}},computed:{},watch:{},methods:{clickChange:function(t){this.autoplay=!1,this.oIndex=t,this.$refs.carouse.setActiveItem(t)},handleDelete:function(t){var e=this;console.log(t.ID);var i={api:"post",url:this.$store.state.http+"System/DelIndexBanner",data:{Id:t.ID}};this.$https(i).then(function(t){e.init(),e.$look("success","提示！","删除成功！")})},UpImgVideo:function(){var t=this;if(console.log(this.UpTitle,this.imageUrlList),""==this.UpTitle)return this.$look("warning","提示！","请输入标题！"),!1;if(0==this.imageUrlList.length)return this.$look("warning","提示！","请上传资源或等待资源加载完成！"),!1;if(1==this.imageUrlList.length&&-1!=this.imageUrlList[0].raw.type.indexOf("video"))return this.$look("warning","提示！","不可单独上传视频！"),!1;var e={api:"post",url:this.$store.state.http+"System/AddIndexBanner",data:{For:this.To,Type:1==this.imageUrlList.length?1:2,Title:this.UpTitle}};this.$https(e).then(function(e){console.log(e.Data),t.UpimgBase64(e.Data,0),2==t.imageUrlList.length&&(t.UpimgBase64(e.Data,1),console.log("两个"))})},UpimgBase64:function(t,e){var i=this,a=this,o={api:"post",url:a.$store.state.http+"System/UploadIndexBanner",data:{Id:t,FileStr:a.imgVideoBase64List[e].base64,Type:-1!=a.imageUrlList[e].raw.type.indexOf("video")?2:1}};console.log(o),a.$https(o).then(function(t){a.dialogVisible=!1,i.init()})},compress:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){var e=new Image;e.src=t;var i,a=document.createElement("canvas"),o=a.getContext("2d"),n=.8*e.width,l=.8*e.height;return a.width=n,a.height=l,o.drawImage(e,0,0,n,l),(i=a.toDataURL("image/jpeg").replace("data:image/jpeg;base64,","")).toString().length>204800?compress(i):(console.log(i),i)}),beforeuploadMainGraph:function(t){if(1==this.imageUrlList.length&&-1!=this.imageUrlList[0].raw.type.indexOf(t.type.split("/")[0]))return this.$look("warning","提示！","类型重复！"),!1;var e=this,i=new FileReader;i.readAsDataURL(t),i.onload=function(a){var o=i.result;e.imgVideoBase64List.push({uid:t.uid,base64:o})}},handleSuccessMainGraph:function(t,e,i){this.imageUrlList=i},handlePreviewMainGraph:function(t){this.imageUrl.type=t.raw.type,this.imageUrl.url=t.url,console.log(t),this.dialogVisibleMainGraph=!0},handleRemoveMainGraph:function(t,e){console.log(t.uid);for(var i=0;i<this.imgVideoBase64List.length;i++){this.imgVideoBase64List[i].uid===t.uid&&this.imgVideoBase64List.splice(i,1)}console.log(this.imgVideoBase64List)},handleClose:function(t){this.$confirm("确认关闭？").then(function(e){t()}).catch(function(t){})},handleClick:function(t,e){console.log(t.index,e),this.To=Number(t.index)+1,this.init()},init:function(){var t=this,e={api:"get",url:t.$store.state.http+"System/GetIndexBanners",data:{to:t.To}};t.$https(e).then(function(e){console.log(e.Data.Dtos);for(var i=e.Data.Dtos,a=0;a<i.length;a++){var o=i[a];o.CreateDate=o.CreateDate.split("T")[0],o.Pos=a+1}t.tableData=i,t.loading=!1,t.rowDrops()})},sortchange:function(t){console.log(t)},rowDrops:function(){var t=document.querySelector("#Swiper .el-table__body-wrapper tbody"),e=this;a.a.create(t,{onEnd:function(t){var i=t.newIndex,a=t.oldIndex;if(console.log(i,a),i==a)return!1;e.loading=!0;var o=e.tableData,n=o[a];o.splice(a,1),o.splice(i,0,n);for(var l=[],r=0;r<o.length;r++){var s=o[r];console.log(s.Title,s.ID),l[r]={Id:s.ID,Sort:r+1}}var c={url:e.$store.state.http+"System/SortIndexBanner",api:"post",data:{Dtos:l}};e.$https(c).then(function(t){e.tableData=[],e.init()})}})}},created:function(){this.init()},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"box"},[i("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"客户端App",name:"first"}}),t._v(" "),i("el-tab-pane",{attrs:{label:"工程师端App",name:"second"}}),t._v(" "),i("el-tab-pane",{attrs:{label:"ERP 系统",name:"third"}})],1),t._v(" "),i("el-carousel",{ref:"carouse",staticStyle:{width:"1300px",margin:"auto"},attrs:{autoplay:t.autoplay,"initial-index":t.oIndex,interval:4e3,type:"card",height:"300px"}},t._l(t.tableData,function(t,e){return i("el-carousel-item",{key:e},[i("img",{staticStyle:{height:"100%","border-radius":"10px"},attrs:{src:"http://icms.inchwell.com.cn/file/IndexBanner/"+t.Image,alt:""}})])}),1),t._v(" "),i("div",{staticStyle:{width:"100%",height:"70px",margin:"50px 0",display:"flex","justify-content":"center"}},t._l(t.tableData,function(e,a){return i("img",{key:a,staticStyle:{height:"100%","border-radius":"10px",margin:"0px 10px"},attrs:{src:"http://icms.inchwell.com.cn/file/IndexBanner/"+e.Image,alt:""},on:{mouseover:function(e){return t.clickChange(a)},mouseleave:function(e){t.autoplay=!0}}})}),0),t._v(" "),i("div",{staticStyle:{width:"531px",margin:"auto"},attrs:{id:"Swiper"}},[i("el-table",{ref:"MC",attrs:{data:t.tableData,border:"","row-key":"id",size:"mini","header-cell-style":{background:"#e1e1e1"},align:"left"},on:{"sort-change":function(e){return t.sortchange(1)}}},[t._l(t.col,function(e,a){return i("el-table-column",{key:"col_"+e.label,attrs:{prop:t.dropCol[a].prop,width:t.dropCol[a].width,"show-overflow-tooltip":t.dropCol[a].widths,label:e.label}})}),t._v(" "),i("el-table-column",{attrs:{align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){return t.handleDelete(e.row)}}},[t._v("删除")])]}}])},[i("template",{slot:"header"},[i("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){t.UpTitle="",t.dialogVisible=!0,t.imageUrlList=[],t.imgVideoBase64List=[]}}},[t._v("添加")])],1)],2)],2)],1),t._v(" "),i("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",[i("el-input",{attrs:{placeholder:"请输入内容",size:"mini"},model:{value:t.UpTitle,callback:function(e){t.UpTitle=e},expression:"UpTitle"}},[i("template",{slot:"prepend"},[t._v("标题：")])],2)],1),t._v(" "),i("el-divider",{attrs:{"content-position":"left"}},[t._v("上传图片 / 视频")]),t._v(" "),i("el-upload",{attrs:{action:t.uploadFileUrlapp,data:{attachType:0},name:"appFile",limit:2,multiple:!0,accept:"image/*,video/*","before-upload":t.beforeuploadMainGraph,"on-success":t.handleSuccessMainGraph,"on-preview":t.handlePreviewMainGraph,"on-remove":t.handleRemoveMainGraph,"list-type":"picture-card","file-list":t.imageUrlList}},[i("i",{staticClass:"el-icon-plus spc1"})]),t._v(" "),i("el-dialog",{staticClass:"spc12",attrs:{visible:t.dialogVisibleMainGraph,"modal-append-to-body":!1},on:{"update:visible":function(e){t.dialogVisibleMainGraph=e}}},["video/mp4"!=t.imageUrl.type?i("img",{attrs:{width:"100%",src:t.imageUrl.url,alt:""}}):t._e(),t._v(" "),"video/mp4"==t.imageUrl.type?i("video",{staticClass:"avatar video-avatar",staticStyle:{width:"100%"},attrs:{src:t.imageUrl.url,controls:"controls"}},[t._v("\n        您的浏览器不支持视频播放\n      ")]):t._e()]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.UpImgVideo()}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l=i("VU/8")(o,n,!1,function(t){i("6FZf")},"data-v-5e8fab91",null);e.default=l.exports}});